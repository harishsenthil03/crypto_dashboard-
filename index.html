<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>NSE AI Trading Signals</title>
<style>
body{font-family:Arial;background:#f3f4f6;padding:15px}
h2{margin-bottom:5px}
.card{background:#fff;padding:12px;border-radius:10px;margin-bottom:12px}
select,button{padding:6px 10px;margin:4px}
table{width:100%;border-collapse:collapse;font-size:13px}
th,td{border:1px solid #ddd;padding:6px;text-align:center}
th{background:#eee}
.buy{color:#16a34a;font-weight:bold}
.sell{color:#dc2626;font-weight:bold}
.hold{color:#777}
.rank1{background:#dcfce7}
small{color:#555}
</style>
</head>

<body>

<h2>üìà NSE AI BUY / SELL SIGNALS</h2>
<small>RSI + EMA + News Sentiment (World Trend)</small>

<div class="card">
<b>Select NSE Stocks</b><br>
<select id="stocks" multiple size="6" style="width:220px">
<option value="RELIANCE.NS">RELIANCE</option>
<option value="TCS.NS">TCS</option>
<option value="INFY.NS">INFY</option>
<option value="HDFCBANK.NS">HDFCBANK</option>
<option value="ICICIBANK.NS">ICICIBANK</option>
<option value="SBIN.NS">SBIN</option>
<option value="ITC.NS">ITC</option>
<option value="LT.NS">LT</option>
<option value="AXISBANK.NS">AXISBANK</option>
<option value="BAJFINANCE.NS">BAJFINANCE</option>
</select><br>
<button onclick="analyze()">Analyze Now</button>
</div>

<div class="card">
<h4>üèÜ Best Stock To Trade Now</h4>
<div id="best">-</div>
</div>

<div class="card">
<h4>üìä Live Signals</h4>
<table>
<thead>
<tr>
<th>Stock</th>
<th>Price</th>
<th>Signal</th>
<th>Confidence</th>
<th>Explanation</th>
</tr>
</thead>
<tbody id="result"></tbody>
</table>
</div>

<script>
const NEWS_KEY = "WKxisHrYpWBZjUUXTBehGAVJm7OujDO0XY7Kdxqe";

async function fetchPrice(symbol){
  let url=`https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=5m&range=1d`;
  let r=await fetch(url);
  let j=await r.json();
  let c=j.chart.result[0];
  return c.indicators.quote[0].close.filter(x=>x);
}

function RSI(closes, period=14){
  if(closes.length<period+1) return 50;
  let gains=0,losses=0;
  for(let i=closes.length-period;i<closes.length;i++){
    let diff=closes[i]-closes[i-1];
    if(diff>0) gains+=diff; else losses+=Math.abs(diff);
  }
  let rs=gains/(losses||1);
  return 100-(100/(1+rs));
}

function EMA(data,period){
  let k=2/(period+1),ema=data[0];
  for(let i=1;i<data.length;i++){
    ema=data[i]*k+ema*(1-k);
  }
  return ema;
}

async function newsSentiment(symbol){
  let s=symbol.replace(".NS","");
  let url=`https://api.marketaux.com/v1/news/all?symbols=${s}&language=en&api_token=${NEWS_KEY}`;
  let r=await fetch(url);
  let j=await r.json();
  if(!j.data||!j.data.length) return 0;
  let score=0;
  j.data.slice(0,5).forEach(n=>{
    if(n.sentiment==="positive") score+=1;
    if(n.sentiment==="negative") score-=1;
  });
  return score;
}

async function analyze(){
  let sel=[...document.getElementById("stocks").selectedOptions].map(o=>o.value);
  let tbody=document.getElementById("result");
  tbody.innerHTML="";
  let ranking=[];

  for(let s of sel){
    let closes=await fetchPrice(s);
    let price=closes[closes.length-1].toFixed(2);
    let rsi=RSI(closes);
    let ema9=EMA(closes.slice(-20),9);
    let ema21=EMA(closes.slice(-30),21);
    let news=await newsSentiment(s);

    let signal="HOLD",conf="LOW",explain=[];

    if(rsi<35 && ema9>ema21 && news>=0){
      signal="BUY"; conf="HIGH";
    }
    else if(rsi>65 && ema9<ema21 && news<=0){
      signal="SELL"; conf="HIGH";
    }
    else if(ema9>ema21){
      signal="BUY"; conf="MEDIUM";
    }
    else if(ema9<ema21){
      signal="SELL"; conf="MEDIUM";
    }

    explain.push(`RSI:${rsi.toFixed(1)}`);
    explain.push(`EMA9 ${ema9>ema21?"‚Üë":"‚Üì"} EMA21`);
    explain.push(`News:${news>=1?"Positive":news<=-1?"Negative":"Neutral"}`);

    let score=(signal==="BUY"?1:signal==="SELL"?0:-1)+(conf==="HIGH"?2:conf==="MEDIUM"?1:0);
    ranking.push({s,score});

    tbody.innerHTML+=`
    <tr>
      <td>${s.replace(".NS","")}</td>
      <td>‚Çπ${price}</td>
      <td class="${signal==="BUY"?"buy":signal==="SELL"?"sell":"hold"}">${signal}</td>
      <td>${conf}</td>
      <td>${explain.join(" | ")}</td>
    </tr>`;
  }

  ranking.sort((a,b)=>b.score-a.score);
  if(ranking.length){
    document.getElementById("best").innerHTML=
      `üî• <b>${ranking[0].s.replace(".NS","")}</b> ‚Äì Best setup now (RSI + EMA + News aligned)`;
  }
}
</script>

</body>
</html>