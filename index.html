<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>NSE AI Trade Signal (News + Trend)</title>

<style>
body{
  font-family: Arial;
  background:#0f172a;
  color:#e5e7eb;
  padding:15px
}
h2{color:#38bdf8}
.card{
  background:#020617;
  border:1px solid #1e293b;
  padding:12px;
  border-radius:10px;
  margin-bottom:12px
}
table{
  width:100%;
  border-collapse:collapse;
  font-size:14px
}
th,td{
  border:1px solid #1e293b;
  padding:8px;
  text-align:center
}
th{background:#020617}
.buy{color:#22c55e;font-weight:bold}
.sell{color:#ef4444;font-weight:bold}
.hold{color:#facc15;font-weight:bold}
.conf-high{color:#22c55e}
.conf-med{color:#facc15}
.conf-low{color:#ef4444}
small{color:#94a3b8}
</style>
</head>

<body>

<h2>ðŸ“ˆ NSE AI Trade Signal (Real-Time News Analysis)</h2>

<div class="card">
<b>Tracked Stocks (NSE)</b><br>
RELIANCE, TCS, INFY, HDFCBANK, ICICIBANK
</div>

<div class="card">
<table>
<thead>
<tr>
<th>Stock</th>
<th>Signal</th>
<th>Confidence</th>
<th>Reason (AI)</th>
<th>Updated Time</th>
</tr>
</thead>
<tbody id="signalTable"></tbody>
</table>
</div>

<div class="card">
<b>ðŸ§  Confidence Explanation</b>
<div id="confidenceExplain">
Waiting for analysis...
</div>
</div>

<script>
/* ================= CONFIG ================= */

const API_KEY = "WKxisHrYpWBZjUUXTBehGAVJm7OujDO0XY7Kdxqe";

const STOCKS = [
  { name:"RELIANCE", symbol:"RELIANCE.NS" },
  { name:"TCS", symbol:"TCS.NS" },
  { name:"INFY", symbol:"INFY.NS" },
  { name:"HDFCBANK", symbol:"HDFCBANK.NS" },
  { name:"ICICIBANK", symbol:"ICICIBANK.NS" }
];

/* ================= CORE LOGIC ================= */

// News sentiment fetch
async function fetchNews(symbol){
  const url =
    `https://api.marketaux.com/v1/news/all?symbols=${symbol}&language=en&limit=10&api_token=${API_KEY}`;
  const res = await fetch(url);
  const data = await res.json();
  return data.data || [];
}

// Sentiment analysis
function analyzeSentiment(news){
  let score = 0;
  news.forEach(n=>{
    if(n.sentiment === "positive") score += 1;
    if(n.sentiment === "negative") score -= 1;
  });
  return score;
}

// AI Signal logic
function generateSignal(sentimentScore, newsCount){
  let signal="HOLD", confidence="LOW", reason="Mixed / Weak sentiment";

  if(sentimentScore >= 3){
    signal="BUY";
    confidence="HIGH";
    reason="Strong positive global news sentiment";
  }
  else if(sentimentScore === 2){
    signal="BUY";
    confidence="MEDIUM";
    reason="Positive news trend forming";
  }
  else if(sentimentScore <= -3){
    signal="SELL";
    confidence="HIGH";
    reason="Strong negative global news sentiment";
  }
  else if(sentimentScore === -2){
    signal="SELL";
    confidence="MEDIUM";
    reason="Increasing negative news pressure";
  }

  return {signal, confidence, reason};
}

// Render table
async function runAnalysis(){
  const table = document.getElementById("signalTable");
  table.innerHTML = "";

  let explainText = "";

  for(let stock of STOCKS){
    let news = await fetchNews(stock.symbol);
    let sentimentScore = analyzeSentiment(news);
    let ai = generateSignal(sentimentScore, news.length);

    let cls =
      ai.signal==="BUY" ? "buy" :
      ai.signal==="SELL" ? "sell" : "hold";

    let confCls =
      ai.confidence==="HIGH" ? "conf-high" :
      ai.confidence==="MEDIUM" ? "conf-med" : "conf-low";

    let time = new Date().toLocaleString();

    table.innerHTML += `
      <tr>
        <td>${stock.name}</td>
        <td class="${cls}">${ai.signal}</td>
        <td class="${confCls}">${ai.confidence}</td>
        <td>${ai.reason}</td>
        <td>${time}</td>
      </tr>
    `;

    explainText += `
      <p>
      <b>${stock.name}</b> â†’ ${ai.signal}<br>
      Reason: ${ai.reason}<br>
      News Articles Analysed: ${news.length}
      </p>
    `;
  }

  document.getElementById("confidenceExplain").innerHTML = explainText;
}

// Auto refresh every 5 minutes
runAnalysis();
setInterval(runAnalysis, 300000);
</script>

</body>
</html>