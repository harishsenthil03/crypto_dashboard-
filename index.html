<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Indian Stocks AI Signals ‚Äì Real‚ÄëTime Polling</title>
<style>
body{font-family:Arial;background:#f2f2f2;padding:15px}
h2{text-align:center}
.card{background:#fff;padding:12px;margin-bottom:12px;border-radius:8px}
table{width:100%;border-collapse:collapse;font-size:13px}
th,td{border:1px solid #ccc;padding:6px;text-align:center}
th{background:#eee}
.buy{color:green;font-weight:bold}
.sell{color:red;font-weight:bold}
.hold{color:#555}
.badge{padding:4px 8px;border-radius:5px;margin:2px;display:inline-block;color:#fff;font-weight:bold}
.high{background:#22c55e}
.medium{background:#facc15;color:#000}
.low{background:#ef4444}
.trend-up{color:green;font-weight:bold}
.trend-down{color:red;font-weight:bold}
.trend-neutral{color:#555}
</style>
</head>
<body>
<h2>üáÆüá≥ NSE AI Signal Dashboard ‚Äì Live Price Polling (1s)</h2>

<div class="card">
<h4>üìù Manage Watchlist</h4>
<input id="newStock" placeholder="Enter NSE symbol e.g. RELIANCE.NS">
<button onclick="addStock()">Add Stock</button>
<button onclick="removeStock()">Remove Last</button>
<p>Watchlist: <span id="watchlistDisplay"></span></p>
</div>

<div class="card">
<h4>üìã Signals</h4>
<table>
<thead>
<tr>
<th>Stock</th><th>Last Price</th><th>Signal</th><th>Conf</th><th>Prob %</th>
<th>RSI</th><th>EMA Trend</th><th>Sentiment</th><th>Reason</th><th>Time</th></tr>
</thead>
<tbody id="stockTable"></tbody>
</table>
</div>

<script>
// ‚Üí CONFIG
let watchlist=["RELIANCE.NS","TCS.NS","INFY.NS"];
const newsHeadlinesCount=5;
const longTermEMA=50;

// ‚Üí ACCURACY STORAGE
let accuracyTracker={};
function ensureTrack(s){
  if(!accuracyTracker[s]) accuracyTracker[s]={buy:{wins:0,total:0},sell:{wins:0,total:0}};
}
watchlist.forEach(s=>ensureTrack(s));

// ‚Üí WATCHLIST UI
function updateWatchlistDisplay(){
  document.getElementById("watchlistDisplay").innerText=watchlist.join(", ");
}
function addStock(){
  let s=document.getElementById("newStock").value.trim().toUpperCase();
  if(s && !watchlist.includes(s)){
    watchlist.push(s); ensureTrack(s);
    updateWatchlistDisplay();
  }
  document.getElementById("newStock").value="";
}
function removeStock(){
  let removed=watchlist.pop(); delete accuracyTracker[removed];
  updateWatchlistDisplay();
}
updateWatchlistDisplay();

// ‚Üí FETCH LIVE PRICE (1s)
async function fetchLivePrice(symbol){
  try{
    let url=`https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=1m&range=1d`;
    let res=await fetch(url);
    let data=await res.json();
    let price=data.chart.result[0].indicators.quote[0].close.slice(-1)[0];
    return price||0;
  }catch(e){return 0;}
}

// ‚Üí FETCH RSI + EMA(20)
async function fetchIndicators(symbol){
  try{
    let url=`https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=15m&range=1d`;
    let res=await fetch(url); let data=await res.json();
    let closes=data.chart.result[0].indicators.quote[0].close;
    let ema=closes.slice(-20).reduce((a,v)=>a+v,0)/20;
    let last=closes[closes.length-1];
    let gains=0, losses=0;
    for(let i=closes.length-14;i<closes.length;i++){
      let diff=closes[i]-closes[i-1]; if(diff>0) gains+=diff; else losses+=Math.abs(diff);
    }
    let rsi=100 - (100/(1+(gains/14)/(losses/14)));
    return {last,rsi,emaTrend:(last>ema?"Up":"Down")};
  }catch(e){return {last:0,rsi:0,emaTrend:"-"};}
}

// ‚Üí FETCH NEWS HEADLINES
async function fetchNews(symbol){
  try{
    let res=await fetch(`https://finance.yahoo.com/quote/${symbol}`);
    let html=await res.text();
    let lines=[...html.matchAll(/"title":"(.*?)"/g)].map(m=>m[1]);
    return lines.slice(0,newsHeadlinesCount);
  }catch(e){return [];}
}
function analyzeSentiment(headlines){
  let score=0;
  const pos=["gain","up","bull","strong","profit","buy","positive","good"];
  const neg=["loss","down","bear","weak","sell","drop","negative","bad"];
  headlines.forEach(h=>{
    let t=h.toLowerCase();
    pos.forEach(p=>{if(t.includes(p))score++});
    neg.forEach(n=>{if(t.includes(n))score--});
  });
  return Math.max(Math.min(score,5),-5);
}

// ‚Üí SIGNAL LOGIC
function aiSignalLogic(priceData, sentiment){
  let {rsi,emaTrend}=priceData;
  let sig="HOLD",conf="LOW",prob=50,reason="No strong signal";
  if(rsi<30 && emaTrend==="Up" && sentiment>0){ sig="BUY"; reason="RSI<30+EMA up+pos news"; }
  else if(rsi>70 && emaTrend==="Down" && sentiment<0){ sig="SELL"; reason="RSI>70+EMA down+neg news"; }
  let score=Math.abs(sentiment)*10 + (sig==="HOLD"?10:30);
  conf=(score>=60?"HIGH":score>=40?"MEDIUM":"LOW"); prob=Math.min(Math.max(score,0),100);
  return {sig,conf,prob,reason};
}

// ‚Üí MAIN UPDATE LOOP
async function updateDashboard(){
  let tbody=document.getElementById("stockTable"); tbody.innerHTML="";
  for(let stock of watchlist){
    let price=await fetchLivePrice(stock);
    let priceData=await fetchIndicators(stock);
    let news=await fetchNews(stock);
    let sentiment=analyzeSentiment(news);
    let ai=aiSignalLogic(priceData,sentiment);

    // UPDATE ACCURACY TRACK
    if(ai.sig==="BUY"){ accuracyTracker[stock].buy.total++; }
    if(ai.sig==="SELL"){ accuracyTracker[stock].sell.total++; }

    tbody.innerHTML+=`
      <tr>
        <td>${stock}</td>
        <td>${price.toFixed(2)}</td>
        <td class="${ai.sig.toLowerCase()}">${ai.sig}</td>
        <td><span class="badge ${ai.conf.toLowerCase()}">${ai.conf}</span></td>
        <td>${ai.prob.toFixed(0)}%</td>
        <td>${priceData.rsi.toFixed(1)}</td>
        <td>${priceData.emaTrend}</td>
        <td>${sentiment}</td>
        <td>${ai.reason}</td>
        <td>${new Date().toLocaleTimeString()}</td>
      </tr>`;
  }
}
// ‚Üí FAST POLLING EVERY 1 SECOND
updateDashboard();
setInterval(updateDashboard, 1000);

</script>
</body>
</html>