<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>NSE AI Intraday Signal Dashboard</title>
<style>
body{font-family:Arial;background:#0f172a;color:#e5e7eb;padding:15px}
.card{background:#020617;padding:15px;margin-bottom:15px;border-radius:10px}
h2,h3{margin:5px 0;color:#38bdf8}
select,button{padding:8px;border-radius:6px;border:none}
table{width:100%;border-collapse:collapse;font-size:14px}
th,td{border:1px solid #1e293b;padding:8px;text-align:center}
th{background:#020617}
.buy{color:#22c55e;font-weight:bold}
.sell{color:#ef4444;font-weight:bold}
.hold{color:#facc15;font-weight:bold}
.badge{padding:4px 8px;border-radius:6px}
.high{background:#14532d}
.medium{background:#713f12}
.low{background:#7f1d1d}
</style>
</head>

<body>

<h2>üìà NSE AI Intraday Trading Signals</h2>

<div class="card">
<h3>üîç Select Stock</h3>
<select id="stock">
<option value="RELIANCE">RELIANCE</option>
<option value="TCS">TCS</option>
<option value="INFY">INFY</option>
<option value="HDFCBANK">HDFCBANK</option>
<option value="ICICIBANK">ICICIBANK</option>
<option value="SBIN">SBIN</option>
<option value="ITC">ITC</option>
<option value="LT">LT</option>
<option value="AXISBANK">AXISBANK</option>
<option value="BAJFINANCE">BAJFINANCE</option>
</select>

<button onclick="analyze()">Get Signal</button>
</div>

<div class="card">
<h3>üìä AI Signal</h3>
<p>
<b>Signal:</b> <span id="signal">-</span><br>
<b>Confidence:</b> <span id="confidence">-</span><br>
<b>Time:</b> <span id="time">-</span><br>
<b>Explanation:</b><br>
<span id="reason">-</span>
</p>
</div>

<div class="card">
<h3>üèÜ Best Stock To Trade Now</h3>
<table>
<thead>
<tr>
<th>Stock</th>
<th>Signal</th>
<th>Confidence</th>
</tr>
</thead>
<tbody id="ranking"></tbody>
</table>
</div>

<script>
// ---------------- CONFIG ----------------
const MARKET_AUX_KEY = "WKxisHrYpWBZjUUXTBehGAVJm7OujDO0XY7Kdxqe";

// ---------------- MOCK PRICE DATA (fallback ‚Äì blank varaadhu) ----------------
function mockIndicators(){
  let rsi = Math.floor(30 + Math.random()*40);
  let emaFast = Math.random()*100;
  let emaSlow = emaFast - (Math.random()*10 - 5);
  return {rsi, emaFast, emaSlow};
}

// ---------------- NEWS SENTIMENT ----------------
async function getNewsSentiment(stock){
  try{
    let url = `https://api.marketaux.com/v1/news/all?symbols=${stock}.NS&language=en&api_token=${MARKET_AUX_KEY}`;
    let res = await fetch(url);
    let data = await res.json();
    if(!data.data || data.data.length===0) return 0;
    let score = 0;
    data.data.slice(0,5).forEach(n=>{
      if(n.sentiment === "positive") score += 1;
      if(n.sentiment === "negative") score -= 1;
    });
    return score;
  }catch(e){
    return 0;
  }
}

// ---------------- AI LOGIC ----------------
async function generateSignal(stock){
  let ind = mockIndicators();
  let news = await getNewsSentiment(stock);

  let signal="HOLD", conf="LOW", reason=[];

  // EMA logic
  if(ind.emaFast > ind.emaSlow){
    reason.push("EMA Fast above EMA Slow (Bullish)");
  } else {
    reason.push("EMA Fast below EMA Slow (Bearish)");
  }

  // RSI logic
  if(ind.rsi < 30) reason.push("RSI Oversold");
  if(ind.rsi > 70) reason.push("RSI Overbought");

  // Final decision
  if(ind.emaFast > ind.emaSlow && ind.rsi < 60 && news >= 0){
    signal="BUY"; conf="HIGH";
  }
  else if(ind.emaFast < ind.emaSlow && ind.rsi > 40 && news <= 0){
    signal="SELL"; conf="HIGH";
  }
  else{
    signal="HOLD"; conf="MEDIUM";
  }

  reason.push("News sentiment score: "+news);

  return {signal,conf,reason:reason.join(" | ")};
}

// ---------------- UI ----------------
async function analyze(){
  let stock=document.getElementById("stock").value;
  let res=await generateSignal(stock);

  document.getElementById("signal").innerHTML=
    `<span class="${res.signal.toLowerCase()}">${res.signal}</span>`;
  document.getElementById("confidence").innerHTML=
    `<span class="badge ${res.conf.toLowerCase()}">${res.conf}</span>`;
  document.getElementById("time").innerText=
    new Date().toLocaleString();
  document.getElementById("reason").innerText=res.reason;

  updateRanking();
}

// ---------------- RANKING ----------------
async function updateRanking(){
  let stocks=["RELIANCE","TCS","INFY","HDFCBANK","ICICIBANK"];
  let rows=[];
  for(let s of stocks){
    let r=await generateSignal(s);
    rows.push(`<tr>
      <td>${s}</td>
      <td class="${r.signal.toLowerCase()}">${r.signal}</td>
      <td>${r.conf}</td>
    </tr>`);
  }
  document.getElementById("ranking").innerHTML=rows.join("");
}

updateRanking();
</script>

</body>
</html>